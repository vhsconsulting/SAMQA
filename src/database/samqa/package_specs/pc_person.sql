create or replace package samqa.pc_person is

/*
????? ??? ???????????? PERSON
 Modification
 11.05.2005 mal Add allow_deductible55
*/
    cursor pers_cur (
        p_in in number
    ) is
    select
        *
    from
        person
    where
        pers_id = p_in;

    pers_rec pers_cur%rowtype;
    cursor col_cur (
        p_in in varchar2,
        t_in in varchar2 := 'PERSON'
    ) is
    select
        data_type
    from
        cols
    where
            column_name = p_in
        and table_name = t_in;

    dummy varchar2(4000);
    date_mask1 varchar2(40) := 'mm-dd-yyyy';
    date_mask2 varchar2(40) := 'fmMonth, dd yyyy';
    function pers_fld (
        pers_in in person.pers_id%type,
        fld_in  in varchar2 default 'LAST_NAME'
    ) return varchar2;

    function acc_card_count (
        dep_id_in in person.pers_id%type
    ) return number;

-- ??? ??.??????? ?????????? ???-?? INSURE
    function count_insure (
        person_id_in in person.pers_id%type
    ) return number;
-- ??? ??.??????? ?????????? ???-?? DEPENDENT-??
    function count_dependent (
        person_id_in in person.pers_id%type
    ) return number;
-- ??? ??.??????? ?????????? ???-?? CLAIM-??
    function count_claim (
        person_id_in in person.pers_id%type
    ) return number;
-- ??? ??.??????? ?????????? ???-?? CLAIM-??
    function count_claimn (
        person_id_in in person.pers_id%type
    ) return number;
-- ??? ??.??????? ?????????? ???-?? ACCOUNT-??
    function count_account (
        person_id_in in person.pers_id%type
    ) return number;
-- ??? ??.??????? ?????????? ???-?? ???????? ???? ? ???? ?????? ?????
-- ?????? ??????? ??? (???????) ????????
    function count_debit_card (
        person_id_in in person.pers_id%type
    ) return number;
-- ??? ??.??????? ?????????? ??. ACCOUNT-? ??? NULL, ???? ???
    function acc_id (
        person_id_in in person.pers_id%type
    ) return account.acc_id%type;
-- ??? ??.??????? ?????????? ??.?????????
    function relat_code (
        person_id_in in person.pers_id%type
    ) return person.relat_code%type;
-- ??? ??.??????? ?????????? ???? (?????)
    function state (
        person_id_in in person.pers_id%type
    ) return person.state%type;
-- ??? ??.??????? ?????????? ????? ACCOUNT-?
    function acc_num (
        person_id_in in person.pers_id%type
    ) return account.acc_num%type;
-- ??? ??.??????? ?????????? ???? ???????? ACCOUNT-?
    function acc_start_date (
        person_id_in in person.pers_id%type
    ) return account.start_date%type;
-- ??? ??.??????? ?????????? ???? ??????????? ACCOUNT-?
    function acc_reg_date (
        person_id_in in person.pers_id%type
    ) return account.reg_date%type;
-- ??? ??.??????? ?????????? ???? ???????? ACCOUNT-?
    function acc_end_date (
        person_id_in in person.pers_id%type
    ) return account.end_date%type;
-- ??? ??.??????? ?????????? ???? ???????? INSURE
    function insure_start_date (
        person_id_in in person.pers_id%type
    ) return insure.start_date%type;
-- ??? ??. ACCOUNT-? ?????????? ??.???????
    function pers_id_from_acc_id (
        acc_id_in in account.acc_id%type
    ) return account.pers_id%type;
-- ??? ??. CLAIM-? ?????????? ??.???????
    function pers_id_from_claim_id (
        claim_id_in in claim.claim_id%type
    ) return claim.pers_id%type;
-- ??? ??. CLAIM-? ?????????? ??.ACCOUNT-?
    function acc_id_from_claim_id (
        claim_id_in in claim.claim_id%type
    ) return account.acc_id%type;
-- ??? ??. CLAIM-? ?????????? ??.??????? (new)
    function pers_id_from_claimn_id (
        claimn_id_in in claimn.claim_id%type
    ) return claimn.pers_id%type;
-- ??? ??. CLAIM-? ?????????? ??.ACCOUNT-? (new)
    function acc_id_from_claimn_id (
        claimn_id_in in claimn.claim_id%type
    ) return account.acc_id%type;
-- ??? ??.??????? ?????????? ?????? ?????, ??????????? ??? ???????? ?? ???? ? ???? year_in
    function allow_deductible (
        pers_id_in in person.pers_id%type,
        year_in    in date default sysdate
    ) return number;
-- ??? ??.??????? ?????????? ??????????? ????? ??????? ?? ???????? (?????? 55 ???)
    function allow_deductible55 (
        pers_id_in in person.pers_id%type,
        year_in    in date default sysdate
    ) return number;
-- ??? ??.??????? ?????????? ?????, ??? ?????????? ? ??????? ????
    function payed (
        acc_id_in in account.acc_id%type
    ) return number;
-- ??? ??.ACCOUNT-? ????? ???????????? ??????? ?? ?????????
    function def_amount (
        acc_id_in in account.acc_id%type
    ) return account.month_pay%type;
-- ??? ??.ACCOUNT-? ????? ??????? ?? ?????????
    function def_pay_code (
        acc_id_in in account.acc_id%type
    ) return account.pay_code%type;
-- ??? ??.??????? ?????????? ????? ???????? CLAIM_CODE
    function get_claim_code (
        id_in in person.pers_id%type
    ) return varchar2;
-- ??? ??.??????? ?????????? ??.??????? ??? ?????, ????????? ??? ???????????
-- ?? ??????? ???????? ???????. ??? ??.??????? ????????????? ?? ?????????
-- ? ????? ???????? ????? ??? ???????.
    function broker_id_dflt (
        pers_id_in in person.pers_id%type
    ) return account.broker_id%type;
-- ??? ??.??????? ?????????? ??.????? ??? ?????, ????????? ??? ???????????
-- ?? ??????? ???????? ???????. ??? ??.????? ????????????? ?? ?????????
-- ? ????? ???????? ????? ??? ???????.
    function plan_code_dflt (
        pers_id_in in person.pers_id%type
    ) return plans.plan_code%type;
-- ??? ??.??????? ?????????? FEE_SETUP ??? ?????, ????????? ??? ???????????
-- ?? ??????? ???????? ???????. ??? FEE_SETUP ???????????? ?? ?????????
-- ? ????? ???????? ????? ??? ???????.
    function fee_setup_dflt (
        pers_id_in   in person.pers_id%type,
        plan_code_in in account.plan_code%type,
        entrp_id_in  in account.entrp_id%type default null
    ) return account.fee_setup%type;
-- ??? ??.??????? ?????????? FEE_MAINT ??? ?????, ????????? ??? ???????????
-- ?? ??????? ???????? ???????. ??? FEE_MAINT ???????????? ?? ?????????
-- ? ????? ???????? ????? ??? ???????.
    function fee_maint_dflt (
        pers_id_in   in person.pers_id%type,
        plan_code_in in account.plan_code%type
    ) return account.fee_maint%type;
-- ??? ??.????? (ACC_ID) ?????????? max(pay_num) ?? PAYMENT
    function max_pay_num_for_acc_id (
        acc_id_in in payment.acc_id%type
    ) return payment.pay_num%type;
-- ??? ??.claim_? (CLAIM_ID) ?????????? max(pay_num) ?? PAYMENT
    function max_pay_num_for_claim_id (
        claim_id_in in claim.claim_id%type
    ) return payment.pay_num%type;
-- ??? ??.claim_? (CLAIMN_ID) ?????????? max(pay_num) ?? PAYMENT
    function max_pay_num_for_claimn_id (
        claimn_id_in in claimn.claim_id%type
    ) return payment.pay_num%type;
-- ??? ??.??????? ?????????? ?????????-?? ?? ????? Debit Card
    function card_allowed (
        person_id_in in person.pers_id%type
    ) return number;

    function acc_balance (
        person_id_in in person.pers_id%type
    ) return number;

    function get_person_name (
        p_pers_id in number
    ) return varchar2;

    function get_person_name (
        p_acc_num in varchar2
    ) return varchar2;

    function get_entrp_id (
        p_acc_id in number
    ) return number;

    function get_entrp_name (
        p_pers_id in number
    ) return varchar2;

    function get_entrp_from_pers_id (
        p_pers_id in number
    ) return number;

    function get_division_code (
        p_pers_id in number
    ) return varchar2;

    function get_division_name (
        p_pers_id in number
    ) return varchar2;

    function get_carrier_name (
        p_pers_id in number
    ) return varchar2;

    function get_pers_id_for_cobra (
        p_cobra_number in number,
        p_person_type  in varchar2
    ) return number;

    function get_orig_sys_ref_for_cobra (
        p_pers_id in number
    ) return varchar2;

-- Added by Swamy for Ticket#9374 on 01/10/2020
    procedure insert_person_audit (
        pers_id        in number,
        p_old_ssn      in varchar2,
        p_new_ssn      in varchar2,
        p_changed_user in number,
        p_changed_date in date
    );

end pc_person;
/


-- sqlcl_snapshot {"hash":"bb6e0121d0920cdb82c0e9c1ba013742cb68458f","type":"PACKAGE_SPEC","name":"PC_PERSON","schemaName":"SAMQA","sxml":""}